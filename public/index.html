<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gryfo | Discovery</title>
    <script src="/socket.io/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #F0F2F5; --text: #1d1d1f; }
        * { margin: 0; padding: 0; box-sizing: border-box; scrollbar-width: none; }
        body { background: var(--bg); font-family: 'Outfit', sans-serif; color: var(--text); overflow: hidden; display: flex; flex-direction: column; height: 100vh; }

        /* HEADER - MIDDLE SEARCH */
        .header { 
            width: 100%; 
            padding: 20px 60px; 
            display: grid; 
            grid-template-columns: 1fr 2fr 1fr; /* Creates a three-column layout to center middle */
            align-items: center; 
            background: var(--bg); 
            z-index: 1000; 
        }
        
        .logo { font-size: 1.8rem; font-weight: 800; cursor: pointer; grid-column: 1; }
        
        .search-wrapper { 
            grid-column: 2; 
            position: relative; 
            width: 100%; 
            max-width: 450px; 
            margin: 0 auto; 
        }
        
        #search-input { 
            width: 100%; padding: 14px 24px; padding-left: 50px; border-radius: 50px; 
            border: none; background: #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.06);
            font-family: inherit; font-size: 1rem; outline: none; transition: 0.3s;
        }
        #search-input:focus { box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .search-icon { position: absolute; left: 20px; top: 14px; color: #aaa; font-size: 1.1rem; }

        /* LAYOUT SLIDE LOGIC */
        #viewport { display: flex; flex: 1; width: 100vw; transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
        .wall-active #viewport { transform: translateX(-20vw); }
        
        #content-scroller { flex: 1; overflow-y: scroll; padding: 20px 60px 60px 60px; height: 100%; }
        
        .section-block { margin-bottom: 50px; }
        .section-header { margin-bottom: 20px; }
        .section-header h2 { font-size: 1.8rem; font-weight: 600; margin-bottom: 4px; }
        .section-header p { color: #888; font-size: 0.95rem; }

        /* COMPACT CARDS */
        .carousel-container { position: relative; }
        .card-grid { display: flex; gap: 18px; overflow-x: auto; padding: 15px 0; scroll-snap-type: x mandatory; scroll-behavior: smooth; }

        .wollo-card { 
            min-width: 230px; height: 330px; background: #fff; border-radius: 35px; 
            padding: 22px; display: flex; flex-direction: column; 
            cursor: pointer; transition: 0.4s; scroll-snap-align: start; flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.02);
        }
        .wollo-card:hover { transform: translateY(-6px); box-shadow: 0 12px 30px rgba(0,0,0,0.06); }
        
        /* BOLD CENTERED HASHTAG */
        .card-visual { 
            width: 100%; flex: 1; border-radius: 25px; 
            display: flex; align-items: center; justify-content: center;
            position: relative; overflow: hidden; padding: 15px;
        }
        .hashtag-display { 
            color: #fff; font-size: 1.7rem; font-weight: 800; 
            text-align: center; word-break: break-word; 
            line-height: 1.1; letter-spacing: -0.8px;
        }
        
        .card-footer-title { 
            margin-top: 18px; font-size: 0.95rem; font-weight: 600; 
            color: #333; text-align: left; padding-left: 5px;
        }

        /* ARROWS */
        .nav-arrow {
            position: absolute; top: 50%; transform: translateY(-50%);
            width: 44px; height: 44px; background: #fff; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 6px 15px rgba(0,0,0,0.08); cursor: pointer; z-index: 10; border: none; transition: 0.2s;
        }
        .nav-arrow:hover { background: #000; color: #fff; }
        .prev-arrow { left: -22px; } .next-arrow { right: -22px; }

        /* DASHBOARD */
        #dashboard { position: fixed; right: -50vw; top: 0; width: 50vw; height: 100vh; background: #fff; border-left: 1px solid #eee; transition: 0.6s cubic-bezier(0.16, 1, 0.3, 1); padding: 80px 60px; z-index: 2000; }
        .wall-active #dashboard { right: 0; }
        .close-btn { cursor: pointer; padding: 10px 20px; background: #f5f5f7; border-radius: 20px; font-weight: 600; display: inline-block; margin-bottom: 30px; }
    </style>
</head>
<body>

    <header class="header">
        <div class="logo" onclick="closeDash()">gryfo</div>
        
        <div class="search-wrapper">
            <span class="search-icon">üîç</span>
            <input type="text" id="search-input" placeholder="Find hashtags..." oninput="handleSearch()">
        </div>
        
        <div style="grid-column: 3;"></div>
    </header>

    <div id="viewport">
        <div id="content-scroller"></div>
        <div id="dashboard">
            <div class="close-btn" onclick="closeDash()">‚Üê Close</div>
            <p id="dash-category" style="color: #999; text-transform: uppercase; letter-spacing: 2px; font-size: 0.75rem;"></p>
            <h1 id="dash-title" style="font-size: 4.5rem; margin: 20px 0; line-height: 0.9; font-weight: 800;"></h1>
            <p id="dash-desc" style="font-size: 1.6rem; color: #666; font-weight: 300; line-height: 1.4;"></p>
        </div>
    </div>

    <script>
        const socket = io();
        socket.on('init_pulse', (categories) => renderView(categories));

        function renderView(data) {
            const scroller = document.getElementById('content-scroller');
            scroller.innerHTML = '';

            Object.keys(data).forEach(catName => {
                const catData = data[catName];
                const sectionId = catName.replace(/\s+/g, '-').toLowerCase();

                const section = document.createElement('div');
                section.className = 'section-block';
                section.id = sectionId;
                section.innerHTML = `
                    <div class="section-header"><h2>${catName}</h2><p>${catData.description}</p></div>
                    <div class="carousel-container">
                        <button class="nav-arrow prev-arrow" onclick="slide('${sectionId}', -1)">‚Üê</button>
                        <div class="card-grid" id="grid-${sectionId}"></div>
                        <button class="nav-arrow next-arrow" onclick="slide('${sectionId}', 1)">‚Üí</button>
                    </div>
                `;

                const grid = section.querySelector('.card-grid');
                catData.items.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'wollo-card';
                    card.dataset.tag = item.tag.toLowerCase();
                    card.onclick = () => openDash(item, catName);
                    card.innerHTML = `
                        <div class="card-visual" style="background: ${item.color}">
                            <div class="hashtag-display">${item.tag}</div>
                        </div>
                        <div class="card-footer-title">${item.title}</div>
                    `;
                    grid.appendChild(card);
                });
                scroller.appendChild(section);
            });
        }

        function handleSearch() {
            const query = document.getElementById('search-input').value.toLowerCase();
            document.querySelectorAll('.section-block').forEach(section => {
                let hasMatch = false;
                section.querySelectorAll('.wollo-card').forEach(card => {
                    const match = card.dataset.tag.includes(query);
                    card.style.display = match ? 'flex' : 'none';
                    if (match) hasMatch = true;
                });
                section.style.display = hasMatch ? 'block' : 'none';
            });
        }

        function slide(id, dir) { document.getElementById(`grid-${id}`).scrollBy({ left: 250 * 3 * dir, behavior: 'smooth' }); }
        
        function openDash(item, cat) {
            document.body.classList.add('wall-active');
            document.getElementById('dash-category').innerText = cat;
            document.getElementById('dash-title').innerText = item.tag;
            document.getElementById('dash-desc').innerText = item.title;
        }
        
        function closeDash() { document.body.classList.remove('wall-active'); }
    </script>
</body>
</html>